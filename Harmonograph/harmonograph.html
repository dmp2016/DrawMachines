<!DOCTYPE html>
<html>
	<head>
		<title>Гармонограф</title>                
	<script>
		

	var
		t = 0,	
		pX = 0,
		pY = 0,
		amp1 = 150,
		amp2 = 150,
		step = 0.05;
		freq = 0;
					
	function getNextPoint() {

//		pX = Math.cos(t)*amp1*Math.exp(-0.005*t);
//		pY = Math.cos(t*3/5)*amp2*Math.exp(-0.005*t);

	
//		pX = amp1*Math.sin(0.5*Math.sin(t)*Math.exp(-0.01*t));
//		pY = amp2*Math.sin(0.5*Math.sin(t*(Math.PI/3.2))*Math.exp(-0.01*t));

	
		pX = Math.sin(t)*amp1*Math.exp(-0.005*t);
		pY = Math.sin(t*freq)*amp2*Math.exp(-0.005*t);
//		amp1 = 150,
//		amp2 = 150,
	
	
	
//		pX = Math.sin(t)*amp1*Math.exp(-0.01*t);
//		pY = Math.sin(t*(Math.PI/3.1))*amp2*Math.exp(-0.01*t);
//		amp1 = 150,
//		amp2 = 150,

	
//		pX = Math.sin(t)*amp1*Math.exp(-0.001*t);
//		pY = Math.sin(t*(Math.PI/3.2))*amp2*Math.exp(-0.003*t);
//		amp1 = 150,
//		amp2 = 180,

	}
	
	function drawNextLine() {
		var canvas = document.getElementById("canvas");
		var ctx = canvas.getContext('2d');
		var dx = canvas.width / 2;
		var dy = canvas.height / 2;
		
		getNextPoint();

		ctx.lineWidth = 0.5;
		ctx.strokeStyle = "black";		
				
		ctx.beginPath();		
		ctx.moveTo(pX + dx, pY + dy);
		t += step;		
		getNextPoint();
		ctx.lineTo(pX + dx, pY + dy);
		ctx.closePath();
		ctx.stroke();		
		
	}
	 
			
	function loader() {
		edtFreq.value = 1.047;
		edtAmp1.value = 150;
		edtAmp2.value = 150;	
		initParams();
	}

	var
		timeout_id = 0;
		
	function onStopClick(){
		if (timeout_id != 0)
		{
			clearInterval(timeout_id);
			timeout_id = 0;
		}
		t = 0;
		btnGo.value = "Старт";
	}
	
	function initParams(){	
		if (isNaN(edtFreq.value))
		{
			alert("Некорректно задано отношение частот. Введите число!");
			return false;
		}
		if (isNaN(edtAmp1.value))
		{
			alert("Некорректно задана амплитуда 1-го маятника!");
			return false;
		}
		if (isNaN(edtAmp2.value))
		{
			alert("Некорректно задана амплитуда 2-го маятника!");			
			return false;
		}
		freq = edtFreq.value;
		amp1 = edtAmp1.value;
		amp2 = edtAmp2.value;
		return true;
	}
		
	function onGoClick(){
		if (timeout_id == 0)
		{
			if (t == 0)
			{
				var canvas = document.getElementById("canvas");
				var ctx = canvas.getContext('2d');
				ctx.clearRect(0, 0, canvas.width, canvas.height);				
				if (!initParams())
					return;
			}		
			timeout_id = setInterval(drawNextLine, 1);
			btnGo.value = "Пауза";
		}
		else
			if (t != 0)
			{
				clearInterval(timeout_id);
				timeout_id = 0;
				btnGo.value = "Дальше";
			}		
	}
	
	function onClearClick(){
		clearInterval(timeout_id);
		timeout_id = 0;
		var canvas = document.getElementById("canvas");
		var ctx = canvas.getContext('2d');
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		t = 0;
	}
	
	function example1(){
		onClearClick();
		onStopClick();
		edtFreq.value = 1.047;
		edtAmp1.value = 150;
		edtAmp1.value = 150;
		initParams();
	}
	
	function example2(){
		onClearClick();
		onStopClick();
		edtFreq.value = 0.988;
		edtAmp1.value = 150;
		edtAmp1.value = 150;
	}


	function example3(){
		onClearClick();
		onStopClick();
		edtFreq.value = 0.8;
		edtAmp1.value = 150;
		edtAmp1.value = 150;
	}

	function example4(){
		onClearClick();
		onStopClick();
		edtFreq.value = 2;
		edtAmp1.value = 150;
		edtAmp1.value = 150;
	}	
	
	function example5(){
		onClearClick();
		onStopClick();
		edtFreq.value = 1.988;
		edtAmp1.value = 150;
		edtAmp1.value = 150;
	}		
	
	function example6(){
		onClearClick();
		onStopClick();
		edtFreq.value = 2.05;
		edtAmp1.value = 150;
		edtAmp1.value = 150;
	}		

	</script>
	<style type="text/css">
		.divcanvas { 
			border: solid 2px black; 
			box-shadow: 0 0 15px rgba(0,0,0,0.5); 
		}
		.leftimg {
			float:left; /* Выравнивание по левому краю */
			margin: 7px 7px 7px 0; /* Отступы вокруг картинки */			
		}
	</style> 
	</head>
	<body onload="loader()" bgcolor="#E0E0E0">
		<h1 align="center">Гармонограф</h1>
		<hr />
			<p>
					<a href="harm.png"><img src="harml.png" alt="Гармонограф" class="centerimg" /></a>
			</p>
			<p>		
				И, наконец, последняя, но далеко не безынтересная (и даже наоборот, наиболее известная), машинка для рисования - гармонограф. В гармонографе 
				рисунок строится колеблющимися в перпендикулярных плоскостях маятниками, к которым прикреплена ручка или карандаш 
				(здесь возможны различные вариации, когда один из маятников качает ручку, 
				а другой - поверхность, на которой строится рисунок; есть также реализации с тремя маятниками, в которых ручка качается в двух плоскостях,
				а третий маятник качает планшет с листом бумаги). Получающийся рисунок зависит от соотношения частот, амплитуды и скорости затухания 
				колебаний маятников.	
			</p>
			<p>
				Простая и оригинальная конструкция гармонографа описана в журнале Квант №2 за 2014 год.
			</p>
			<p>
				Здесь же, на рисунке, приведена конструкция гармонографа из Техники-Молодёжи №7 за 1965 год, а ниже представлена модель, имитирующая работу гармонографа. (Стоит отметить, что модель хорошо работает для малых колебаний маятников. При большой амплитуде колебаний реальный рисунок 
				в общих чертах похож на то, что получается на этой страничке, но будет несколько "покривее"). Параметры необходимо задать в соответствующих полях ввода. Также 
				представлены примеры нескольких готовых построений, после нажатия кнопки Выбрать параметры установятся так, чтобы получился указанный рисунок.
			</p>										
		</table>
		<hr />
		<table>
			<tr>
				<td align="center">				  
					<input id="btnGo" value="Старт" type="button" onclick="onGoClick()">
					<input id="btnStop" value="Стоп" type="button" onclick="onStopClick()">
					<input id="btnClear" value="Очистить" type="button" onclick="onClearClick()">
				</td>
				<td>
				</td>
			<tr>
				<td>
					<canvas id="canvas" class="divcanvas" width="500"height="500"> </canvas>
				</td>
				<td valign="top">	
					Отношение частот (1-10): <input id="edtFreq" type="number" step = "0.001" min="0" max="5" size="6">
					<br />
					Амплитуда 1-го маятника (0-200): <input id="edtAmp1" type="number" min="0" max="200" size="6">
					<br />
					Амплитуда 2-го маятника (0-200): <input id="edtAmp2" type="number" min="0" max="200" size="6">
					<br />
					<hr />
					<br />
					Примеры:
					<table>
						<tr>
							<td>
								<img src="hrm1l.png" alt="Пример1" />
							</td>						
							<td>
								<input id="btnEx1" value="Выбрать" type="button" onclick="example1()">
							</td>			
							<td>
								<img src="hrm4l.png" alt="Пример4" />
							</td>						
							<td>
								<input id="btnEx4" value="Выбрать" type="button" onclick="example4()">
							</td>										
						</tr>
						<tr>
							<td>
								<img src="hrm2l.png" alt="Пример2" />
							</td>						
							<td>
								<input id="btnEx2" value="Выбрать" type="button" onclick="example2()">
							</td>
							<td>
								<img src="hrm5l.png" alt="Пример5" />
							</td>						
							<td>
								<input id="btnEx5" value="Выбрать" type="button" onclick="example5()">
							</td>							
						</tr>
						<tr>						
							<td>
								<img src="hrm3l.png" alt="Пример3" />
							</td>						
							<td>
								<input id="btnEx3" value="Выбрать" type="button" onclick="example3()">
							</td>
							<td>
								<img src="hrm6l.png" alt="Пример6" />
							</td>						
							<td>
								<input id="btnEx6" value="Выбрать" type="button" onclick="example6()">
							</td>																							
						</tr>
					</table>								
				</td>
			</tr>
		</table>
		</br>
		<a href= "../DrawKaleidoscope/DrawKaleidoscope.html"> Рисовальный калейдоскоп </a>
		</br>
		<a href= "../desgraph/desgraph.html"> Дезайнограф </a>		
	</body>
</html>
